- name: Create a tempory download directory
  tempfile:
    state: directory
    suffix: tentris
  register: tempdir

- name: copy script
  copy:
    src: clone_and_build_tentris.sh
    dest: '{{ tempdir.path }}'

- name: Build Tentris binaries
  command: 'sh {{ tempdir.path }}/clone_and_build_tentris.sh {{ tentris_version }}'

- name: Create installation directory
  file:
    path: "{{ target_dir }}/triplestores/tentris/{{ tentris_version }}"
    state: directory

- name: Install tentris binaries
  copy:
    remote_src: yes
    src: "{{ tempdir.path }}/tentris_{{ tentris_version }}"
    dest: "{{ target_dir }}/triplestores/tentris/{{ tentris_version }}"
    mode: 0755

- name: Delete tempdir
  file:
    path: "{{ tempdir.path }}"
    state: absent
